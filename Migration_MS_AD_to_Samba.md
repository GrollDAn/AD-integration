## Миграция подразделений, групп и пользователей с домена MS AD на Samba AD с использованием ADMT

В данной статье рассмотрен процесс миграции пользователей, групп и подразделений с домена Microsoft Active Directory (MS AD) на Samba Active Directory (Samba AD) с использованием инструмента ADMT. В качестве примера используются два домена:

- **alt.trust** — домен на контроллере ALT Server.
- **wind.trust** — домен на контроллере Windows Server 2019.

### Подготовка к миграции

Для успешной миграции необходимо выполнить следующие шаги:


#### 1. Настройка двустороннего доверительного отношения

Перед началом миграции необходимо настроить двусторонние доверительные отношения между доменами **alt.trust** и **wind.trust**. Подробное руководство доступно по [этой ссылке](https://www.altlinux.org/ActiveDirectory/Trusts).


#### 2. Установка SQL Server Express 2019

На контроллере домена Windows Server 2019 требуется установить **SQL Server Express 2019**, так как инструмент ADMT использует SQL Server для хранения данных миграции. Скачать SQL Server Express 2019 можно с официального сайта Microsoft по [этой ссылке](https://www.microsoft.com/ru-ru/download/details.aspx?id=101064).




####  3. Установка ADMT 3.2

Скачайте и установите инструмент **Active Directory Migration Tool (ADMT) 3.2** с [официального сайта Microsoft](https://www.microsoft.com/en-us/download/details.aspx?id=56570).



#### 4. Добавление администратора домена wind.trust в группу **Administrators** домена alt.trust

Для выполнения миграции администратор домена **wind.trust** должен быть добавлен в группу **Administrators** в домене **alt.trust**. Это необходимо для обеспечения необходимых прав на выполнение операций миграции.

#### Шаги для добавления:

**4.1 Получение SID пользователя "Администратор" из домена wind.trust**

На контроллере домена **alt.trust** выполните следующую команду, чтобы получить SID пользователя "Администратор":

```
[root@DC2 ~]# wbinfo -n WIND\\Администратор
```
Результат:

```
 S-1-5-21-3089077194-1592654026-120093331-500 SID_USER (1)
```

SID пользователя понадобится на следующем шаге.

**4.2 Добавление пользователя в группу Administrators**

Используя полученный SID, добавьте пользователя "Администратор" в группу Administrators:

```
[root@DC2 ~]# samba-tool group addmembers administrators S-1-5-21-3089077194-1592654026-120093331-500
```
Резульат:
```
Added members to group administrators
```

**4.3 Проверка добавления пользователя**

Убедитесь, что пользователь был успешно добавлен в группу Administrators, выполнив следующую команду:
```
[root@DC2 ~]# samba-tool group listmembers administrators
```
Резульат:
```
Domain Admins
Enterprise Admins
Administrator
S-1-5-21-3089077194-1592654026-120093331-500
```


Если SID отображается в списке, настройка завершена успешно.

---







